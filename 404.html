<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>אצטדיון 404 - החוויה המלאה</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Heebo', sans-serif; }
        #final-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; display: none; z-index: 100;
            flex-direction: column; justify-content: center; align-items: center;
            color: white;
        }
        .timer-text { font-size: 3rem; margin-bottom: 1rem; text-align: center; }
        #timer-val { font-size: 12rem; font-weight: 900; color: #2ecc71; }
    </style>
</head>
<body>

<div id="final-screen">
    <div class="timer-text">הדף לא נמצא!<br>חוזרים לחנות בעוד...</div>
    <div id="timer-val">3</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/20.0.0/tween.umd.js"></script>

<script>
    let scene, camera, renderer, ball, scoreboard, mainLight, hemiLight;
    let fans = [], isScored = false;
    const mouse = new THREE.Vector2();

    init();
    animate();

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x020205);
        scene.fog = new THREE.FogExp2(0x020205, 0.001);

        camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 5000);
        camera.position.set(0, 200, 450);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        hemiLight = new THREE.HemisphereLight(0x404070, 0x000000, 0.6);
        scene.add(hemiLight);

        mainLight = new THREE.DirectionalLight(0xffffff, 1);
        mainLight.position.set(100, 300, 100);
        mainLight.castShadow = true;
        scene.add(mainLight);

        // מגרש
        const pitch = new THREE.Mesh(
            new THREE.PlaneGeometry(400, 600),
            new THREE.MeshStandardMaterial({ color: 0x1a3d1a })
        );
        pitch.rotation.x = -Math.PI / 2;
        pitch.receiveShadow = true;
        scene.add(pitch);

        createGrandStadium();
        createGoalAndScoreboard();

        // כדור
        const ballTexture = new THREE.TextureLoader().load('https://i.postimg.cc/brSRNJm1/7D29AA03-1C4F-4578-85D5-F3A23D3D84EC.png');
        ball = new THREE.Mesh(
            new THREE.SphereGeometry(2.5, 32, 32),
            new THREE.MeshStandardMaterial({ map: ballTexture })
        );
        ball.position.set(0, 2.5, 120);
        ball.castShadow = true;
        scene.add(ball);

        // פתיחה סינמטית
        new TWEEN.Tween(camera.position)
            .to({ x: 0, y: 15, z: 200 }, 3000)
            .easing(TWEEN.Easing.Cubic.InOut)
            .onUpdate(() => camera.lookAt(0, 5, 0))
            .start();

        window.addEventListener('mousedown', onMouseDown);
    }

    function createGrandStadium() {
        // הגדרות יציעים - קומה 1 וקומה 2
        const standsConfigs = [
            { w: 450, h: 70, x: 0, z: -220, r: 0 },         // צפון
            { w: 450, h: 70, x: 0, z: 280, r: Math.PI },    // דרום
            { w: 650, h: 70, x: -220, z: 0, r: Math.PI/2 }, // מערב
            { w: 650, h: 70, x: 220, z: 0, r: -Math.PI/2 }  // מזרח
        ];

        standsConfigs.forEach(s => {
            // קומה ראשונה
            createStand(s.w, s.h, s.x, s.z, s.r, 0);
            // קומה שנייה (גבוהה יותר ואחורה יותר)
            createStand(s.w + 50, s.h, s.x * 1.3, s.z * 1.3, s.r, 80);
        });
    }

    function createStand(w, h, x, z, r, yOffset) {
        const group = new THREE.Group();
        const standGeo = new THREE.BoxGeometry(w, h, 50);
        const standMat = new THREE.MeshStandardMaterial({ color: 0x111111 });
        const stand = new THREE.Mesh(standGeo, standMat);
        stand.position.y = h / 2;
        group.add(stand);

        const rows = 8;
        const perRow = 40;
        for(let rIdx=0; rIdx < rows; rIdx++) {
            for(let i=0; i < perRow; i++) {
                const person = new THREE.Group();
                const bodyCol = new THREE.Color().setHSL(Math.random(), 0.7, 0.5);
                const body = new THREE.Mesh(new THREE.BoxGeometry(1.8, 2.5, 1.2), new THREE.MeshStandardMaterial({color: bodyCol}));
                const head = new THREE.Mesh(new THREE.SphereGeometry(0.7), new THREE.MeshStandardMaterial({color: 0xffdbac}));
                head.position.y = 1.6;
                person.add(body, head);
                
                person.position.set(
                    ((i/perRow)-0.5) * w * 0.9, 
                    (rIdx * 7) + 5, 
                    25 - (rIdx * 4)
                );
                person.userData.originalY = person.position.y + yOffset;
                person.userData.phase = Math.random() * Math.PI * 2;
                fans.push(person);
                group.add(person);
            }
        }
        group.position.set(x, yOffset, z);
        group.rotation.y = r;
        scene.add(group);
    }

    function createGoalAndScoreboard() {
        const goal = new THREE.Group();
        const frameMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
        const postG = new THREE.CylinderGeometry(0.8, 0.8, 30);
        
        const p1 = new THREE.Mesh(postG, frameMat); p1.position.set(-30, 15, 0);
        const p2 = new THREE.Mesh(postG, frameMat); p2.position.set(30, 15, 0);
        const bar = new THREE.Mesh(new THREE.CylinderGeometry(0.8, 0.8, 60), frameMat);
        bar.rotation.z = Math.PI/2; bar.position.y = 30;
        
        goal.add(p1, p2, bar);
        goal.position.z = -180;
        scene.add(goal);

        const canvas = document.createElement('canvas');
        canvas.width = 1024; canvas.height = 512;
        const ctx = canvas.getContext('2d');
        const texture = new THREE.CanvasTexture(canvas);
        
        const updateScreen = (text, subtext = "") => {
            ctx.fillStyle = '#000';
            ctx.fillRect(0,0,1024,512);
            ctx.strokeStyle = '#2ecc71'; ctx.lineWidth = 40; ctx.strokeRect(0,0,1024,512);
            
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 180px Heebo';
            ctx.textAlign = 'center';
            ctx.fillText(text, 512, 260);
            
            ctx.font = 'bold 90px Heebo';
            ctx.fillStyle = '#2ecc71';
            ctx.fillText(subtext, 512, 420);
            texture.needsUpdate = true;
        };
        updateScreen("404");

        scoreboard = new THREE.Mesh(
            new THREE.BoxGeometry(120, 60, 5),
            new THREE.MeshBasicMaterial({ map: texture })
        );
        scoreboard.position.set(0, 110, -210);
        scene.add(scoreboard);
        scoreboard.userData.update = updateScreen;
    }

    function onMouseDown(event) {
        if (isScored) return;
        isScored = true;

        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

        const targetX = mouse.x * 50;
        const targetY = Math.max(5, (mouse.y + 0.5) * 50);

        new TWEEN.Tween(ball.position)
            .to({ x: targetX, y: targetY, z: -180 }, 800)
            .easing(TWEEN.Easing.Quadratic.Out)
            .onComplete(() => {
                startCelebration();
            })
            .start();

        new TWEEN.Tween(ball.rotation).to({ x: 15, z: 5 }, 800).start();
    }

    function startCelebration() {
        scoreboard.userData.update("גולללללללל");
        
        // אפקט אורות מטורף
        const flashInterval = setInterval(() => {
            mainLight.color.setHSL(Math.random(), 1, 0.5);
            hemiLight.intensity = Math.random() * 2;
        }, 100);

        setTimeout(() => {
            clearInterval(flashInterval);
            mainLight.color.setHex(0xffffff);
            mainLight.intensity = 5;
            
            // מצלמה טסה למסך
            new TWEEN.Tween(camera.position)
                .to({ x: 0, y: 110, z: -205 }, 1500)
                .easing(TWEEN.Easing.Exponential.In)
                .onUpdate(() => camera.lookAt(0, 110, -210))
                .onComplete(showFinalCountdown)
                .start();
        }, 2500);
    }

    function showFinalCountdown() {
        const screen = document.getElementById('final-screen');
        screen.style.display = 'flex';
        let count = 3;
        const timer = setInterval(() => {
            count--;
            if(count >= 0) document.getElementById('timer-val').innerText = count;
            if(count <= 0) {
                clearInterval(timer);
                window.location.href = "/";
            }
        }, 1000);
    }

    function animate(time) {
        requestAnimationFrame(animate);
        TWEEN.update(time);

        // תנועת קהל - קופצים חזק יותר בגול
        fans.forEach(f => {
            const jumpSpeed = isScored ? 0.02 : 0.005;
            const jumpHeight = isScored ? 20 : 0.6;
            f.position.y = f.userData.originalY + Math.sin(time * jumpSpeed + f.userData.phase) * jumpHeight;
        });

        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
</script>
</body>
</html>
